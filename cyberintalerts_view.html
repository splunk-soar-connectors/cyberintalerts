<!DOCTYPE html>
<html>
<head>
<title>Enriched Alerts</title>
<style>
    body {
        font-family: Arial, sans-serif;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
    }
    th {
        background-color: #f2f2f2;
    }
</style>
</head>
<body>

<h1>Enriched Alerts</h1>

{% if alerts %}
    <table>
        <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Severity</th>
            <th>Tags</th>
            <th>Indicators</th>
            <th>Update Status</th>
        </tr>
        {% for alert in alerts %}
        <tr>
            <td>{{ alert.title }}</td>
            <td>{{ alert.description }}</td>
            <td>{{ alert.severity }}</td>
            <td>{{ alert.tags|join:", " }}</td>
            <td>
                <ul>
                {% for indicator in alert.indicators %}
                    <li>{{ indicator.value }} ({{ indicator.type }})
                        <button onclick="enrich('{{ indicator.type }}', '{{ indicator.value }}')">Enrich</button>
                    </li>
                {% endfor %}
                </ul>
            </td>
            <td>
                <form action="/update_alert_status/" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="Alert_Ref_IDs" value="{{ alert.ref_id }}">
                    <input type="text" name="Closure_Reason" placeholder="Closure Reason">
                    <select name="Status">
                        <option value="open">Open</option>
                        <option value="acknowledged">Acknowledged</option>
                        <option value="closed">Closed</option>
                    </select>
                    <input type="submit" value="Update">
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
{% else %}
    <p>No alerts found.</p>
{% endif %}

<script>
function enrich(type, value) {
    fetch(`/enrich_indicator/?type=${type}&value=${value}`)
        .then(response => response.json())
        .then(data => {
            alert(JSON.stringify(data, null, 2));
        });
}
</script>

</body>
</html>
